<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üõ£Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –¥–æ—Ä–æ–≥</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #1a1a1a;
      font-family: 'Courier New', monospace;
      color: #0f0;
      padding: 20px;
      overflow-x: hidden;
    }
    h1 {
      text-align: center;
      text-shadow: 0 0 10px #0f0;
      margin-bottom: 20px;
    }
    .container {
      display: flex;
      gap: 20px;
      max-width: 1800px;
      margin: 0 auto;
    }
    .left-panel {
      width: 350px;
      background: rgba(0,0,0,0.9);
      border: 2px solid #0f0;
      border-radius: 10px;
      padding: 15px;
      max-height: calc(100vh - 100px);
      overflow-y: auto;
    }
    .canvas-container {
      flex: 1;
      border: 3px solid #0f0;
      border-radius: 10px;
      overflow: hidden;
      background: #000;
      position: relative;
    }
    canvas {
      display: block;
      max-width: 100%;
      cursor: crosshair;
    }
    .section {
      background: rgba(0,255,0,0.05);
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #0f0;
    }
    .section h3 {
      margin-bottom: 10px;
      color: #0ff;
      font-size: 14px;
    }
    button, label.file-btn {
      padding: 10px 15px;
      background: linear-gradient(135deg, #0f0, #0c0);
      color: #000;
      border: 2px solid #0f0;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      font-size: 13px;
      width: 100%;
      margin-bottom: 8px;
      display: block;
      text-align: center;
    }
    button:hover, label.file-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 0 10px #0f0;
    }
    input[type="file"] { display: none; }
    .slider-group {
      margin-bottom: 12px;
    }
    .slider-group label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-size: 12px;
    }
    .slider-group input[type="range"] {
      width: 100%;
      height: 25px;
      cursor: pointer;
    }
    .value {
      color: #ff0;
      font-weight: bold;
    }
    .info-box {
      background: rgba(0,0,0,0.8);
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 10px;
      font-size: 11px;
    }
    .export-area {
      background: #000;
      border: 1px solid #0f0;
      border-radius: 5px;
      padding: 10px;
      font-size: 10px;
      max-height: 150px;
      overflow-y: auto;
      color: #0ff;
      margin-top: 10px;
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    .btn-danger {
      background: linear-gradient(135deg, #f00, #c00);
      border-color: #f00;
    }
  </style>
</head>
<body>
  <h1>üõ£Ô∏è –ò–ù–°–¢–†–£–ú–ï–ù–¢ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ö–ê–†–¢–´ –î–û–†–û–ì</h1>
  
  <div class="container">
    <div class="left-panel">
      <!-- –ó–ê–ì–†–£–ó–ö–ê -->
      <div class="section">
        <h3>üìÅ –ó–ê–ì–†–£–ó–ö–ê</h3>
        <label for="carpet-upload" class="file-btn">üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–≤–µ—Ä (carpet-scan.jpg)</label>
        <input type="file" id="carpet-upload" accept="image/*">
        
        <label for="roads-upload" class="file-btn" style="background: linear-gradient(135deg, #f0f, #c0c); border-color: #f0f;">
          üó∫Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å road_system.js
        </label>
        <input type="file" id="roads-upload" accept=".js">
        
        <div class="info-box" id="load-status">
          –ö–æ–≤–µ—Ä: ‚ùå | –î–æ—Ä–æ–≥–∏: ‚ùå
        </div>
      </div>

      <!-- –ú–ê–°–®–¢–ê–ë -->
      <div class="section">
        <h3>üîç –ú–ê–°–®–¢–ê–ë –ö–ê–†–¢–´</h3>
        <div class="slider-group">
          <label>
            <span>–ú–∞—Å—à—Ç–∞–± X:</span>
            <span class="value" id="scale-x-val">1.00</span>
          </label>
          <input type="range" id="scale-x" min="0.5" max="2.0" step="0.01" value="1.0">
        </div>
        <div class="slider-group">
          <label>
            <span>–ú–∞—Å—à—Ç–∞–± Y:</span>
            <span class="value" id="scale-y-val">1.00</span>
          </label>
          <input type="range" id="scale-y" min="0.5" max="2.0" step="0.01" value="1.0">
        </div>
        <button id="reset-scale">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±</button>
      </div>

      <!-- –°–ú–ï–©–ï–ù–ò–ï -->
      <div class="section">
        <h3>üìç –°–ú–ï–©–ï–ù–ò–ï</h3>
        <div class="slider-group">
          <label>
            <span>–°–¥–≤–∏–≥ X:</span>
            <span class="value" id="offset-x-val">0</span>
          </label>
          <input type="range" id="offset-x" min="-500" max="500" step="5" value="0">
        </div>
        <div class="slider-group">
          <label>
            <span>–°–¥–≤–∏–≥ Y:</span>
            <span class="value" id="offset-y-val">0</span>
          </label>
          <input type="range" id="offset-y" min="-500" max="500" step="5" value="0">
        </div>
        <button id="reset-offset">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å–º–µ—â–µ–Ω–∏–µ</button>
      </div>

      <!-- –ü–û–í–û–†–û–¢ -->
      <div class="section">
        <h3>üîÑ –ü–û–í–û–†–û–¢</h3>
        <div class="slider-group">
          <label>
            <span>–£–≥–æ–ª:</span>
            <span class="value" id="rotation-val">0¬∞</span>
          </label>
          <input type="range" id="rotation" min="-180" max="180" step="1" value="0">
        </div>
        <button id="reset-rotation">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–≤–æ—Ä–æ—Ç</button>
      </div>

      <!-- –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø -->
      <div class="section">
        <h3>üé® –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø</h3>
        <div class="slider-group">
          <label>
            <span>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–æ—Ä–æ–≥:</span>
            <span class="value" id="opacity-val">0.8</span>
          </label>
          <input type="range" id="opacity" min="0" max="1" step="0.1" value="0.8">
        </div>
        <div class="slider-group">
          <label>
            <span>–®–∏—Ä–∏–Ω–∞ –ª–∏–Ω–∏–π:</span>
            <span class="value" id="width-val">8</span>
          </label>
          <input type="range" id="width" min="2" max="20" step="1" value="8">
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="show-nodes">
          <label for="show-nodes">–ü–æ–∫–∞–∑–∞—Ç—å —É–∑–ª—ã</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="show-roundabouts" checked>
          <label for="show-roundabouts">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–≤—è–∑–∫–∏</label>
        </div>
      </div>

      <!-- –î–ï–ô–°–¢–í–ò–Ø -->
      <div class="section">
        <h3>‚öôÔ∏è –î–ï–ô–°–¢–í–ò–Ø</h3>
        <button id="export-coords">üìã –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</button>
        <button id="export-code">üíæ –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–¥–∞ –¥–ª—è game</button>
        <button id="reset-all" class="btn-danger">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
        
        <div class="export-area" id="export-output" style="display: none;"></div>
      </div>

      <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
      <div class="section">
        <h3>üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h3>
        <div class="info-box" id="stats">
          –£–∑–ª–æ–≤: 0<br>
          –î–æ—Ä–æ–≥: 0<br>
          –†–∞–∑–≤—è–∑–æ–∫: 0
        </div>
      </div>
    </div>

    <div class="canvas-container">
      <canvas id="canvas"></canvas>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let carpetImg = null;
    let roadNodes = [];
    let roadGroups = [];
    let roundabouts = [];
    
    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
    let scaleX = 1.0, scaleY = 1.0;
    let offsetX = 0, offsetY = 0;
    let rotation = 0;
    let opacity = 0.8, lineWidth = 8;
    let showNodes = false, showRoundabouts = true;

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–≤—Ä–∞
    document.getElementById('carpet-upload').onchange = (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
          carpetImg = new Image();
          carpetImg.onload = () => {
            updateStatus();
            draw();
          };
          carpetImg.src = ev.target.result;
        };
        reader.readAsDataURL(file);
      }
    };

    // –ó–∞–≥—Ä—É–∑–∫–∞ road_system.js
    document.getElementById('roads-upload').onchange = (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
          try {
            const code = ev.target.result;
            parseRoadSystem(code);
            updateStatus();
            draw();
          } catch (err) {
            alert('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–∞–π–ª–∞: ' + err.message);
          }
        };
        reader.readAsText(file);
      }
    };

    function parseRoadSystem(code) {
      // –ò—â–µ–º roundabout1, roundabout2, roundabout3
      const r1Match = code.match(/const roundabout1 = \[([\s\S]*?)\];/);
      const r2Match = code.match(/const roundabout2 = \[([\s\S]*?)\];/);
      const r3Match = code.match(/const roundabout3 = \[([\s\S]*?)\];/);
      
      roundabouts = [];
      if (r1Match) roundabouts.push(parseNodeArray(r1Match[1]));
      if (r2Match) roundabouts.push(parseNodeArray(r2Match[1]));
      if (r3Match) roundabouts.push(parseNodeArray(r3Match[1]));

      // –ò—â–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã —É–∑–ª–æ–≤
      roadGroups = [];
      const groupMatches = code.matchAll(/const (\w+) = \[([\s\S]*?)\];/g);
      for (const match of groupMatches) {
        const name = match[1];
        if (!name.includes('roundabout') && !name.includes('center')) {
          roadGroups.push(parseNodeArray(match[2]));
        }
      }

      // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–∑–ª—ã
      roadNodes = [...roundabouts.flat(), ...roadGroups.flat()];
      
      console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${roadNodes.length} —É–∑–ª–æ–≤, ${roundabouts.length} —Ä–∞–∑–≤—è–∑–æ–∫, ${roadGroups.length} –¥–æ—Ä–æ–≥`);
    }

    function parseNodeArray(str) {
      const nodes = [];
      const matches = str.matchAll(/\{\s*x:\s*([-\d.]+),\s*y:\s*([-\d.]+)\s*\}/g);
      for (const match of matches) {
        nodes.push({ x: parseFloat(match[1]), y: parseFloat(match[2]) });
      }
      return nodes;
    }

    function updateStatus() {
      const carpetStatus = carpetImg ? '‚úÖ' : '‚ùå';
      const roadsStatus = roadNodes.length > 0 ? '‚úÖ' : '‚ùå';
      document.getElementById('load-status').innerHTML = `–ö–æ–≤–µ—Ä: ${carpetStatus} | –î–æ—Ä–æ–≥–∏: ${roadsStatus}`;
      
      document.getElementById('stats').innerHTML = `
        –£–∑–ª–æ–≤: ${roadNodes.length}<br>
        –î–æ—Ä–æ–≥: ${roadGroups.length}<br>
        –†–∞–∑–≤—è–∑–æ–∫: ${roundabouts.length}
      `;
    }

    function transformCoords(x, y) {
      // –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (-1..1) -> canvas —Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      
      // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –æ—Ç —Ü–µ–Ω—Ç—Ä–∞
      let nx = ((parseFloat(x) + 1.0) / 2.0) * canvas.width;
      let ny = ((1.2 - parseFloat(y)) / 2.4) * canvas.height;
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å—à—Ç–∞–± –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞
      nx = centerX + (nx - centerX) * scaleX;
      ny = centerY + (ny - centerY) * scaleY;
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–≤–æ—Ä–æ—Ç
      if (rotation !== 0) {
        const rad = rotation * Math.PI / 180;
        const dx = nx - centerX;
        const dy = ny - centerY;
        nx = centerX + dx * Math.cos(rad) - dy * Math.sin(rad);
        ny = centerY + dx * Math.sin(rad) + dy * Math.cos(rad);
      }
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ
      nx += offsetX;
      ny += offsetY;
      
      return { x: nx, y: ny };
    }

    function draw() {
      if (!carpetImg || !carpetImg.complete) {
        canvas.width = 1000;
        canvas.height = 1200;
        ctx.fillStyle = '#222';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#0f0';
        ctx.font = 'bold 24px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('üëÜ –ó–ê–ì–†–£–ó–ò–¢–ï –ö–û–í–ï–† –ò –ö–ê–†–¢–£ –î–û–†–û–ì', canvas.width/2, canvas.height/2);
        return;
      }

      canvas.width = carpetImg.width;
      canvas.height = carpetImg.height;
      
      ctx.drawImage(carpetImg, 0, 0);

      if (roadNodes.length === 0) return;

      ctx.globalAlpha = opacity;
      ctx.strokeStyle = '#f00';
      ctx.lineWidth = lineWidth;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';

      // –†–∏—Å—É–µ–º –¥–æ—Ä–æ–≥–∏ (–≥—Ä—É–ø–ø–∞–º–∏)
      roadGroups.forEach(group => {
        ctx.beginPath();
        group.forEach((node, i) => {
          const pos = transformCoords(node.x, node.y);
          i === 0 ? ctx.moveTo(pos.x, pos.y) : ctx.lineTo(pos.x, pos.y);
        });
        ctx.stroke();
      });

      // –†–∏—Å—É–µ–º —Ä–∞–∑–≤—è–∑–∫–∏
      if (showRoundabouts) {
        roundabouts.forEach(roundabout => {
          ctx.beginPath();
          roundabout.forEach((node, i) => {
            const pos = transformCoords(node.x, node.y);
            i === 0 ? ctx.moveTo(pos.x, pos.y) : ctx.lineTo(pos.x, pos.y);
          });
          ctx.closePath();
          ctx.strokeStyle = '#ff0';
          ctx.lineWidth = lineWidth;
          ctx.stroke();
          
          // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ —Ä–∞–∑–≤—è–∑–∫–∏
          if (roundabout.length > 0) {
            const centerNode = roundabout[Math.floor(roundabout.length / 2)];
            const pos = transformCoords(centerNode.x, centerNode.y);
            ctx.fillStyle = '#0ff';
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, 6, 0, Math.PI * 2);
            ctx.fill();
          }
        });
      }

      // –†–∏—Å—É–µ–º —É–∑–ª—ã
      if (showNodes) {
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#0f0';
        roadNodes.forEach(node => {
          const pos = transformCoords(node.x, node.y);
          ctx.beginPath();
          ctx.arc(pos.x, pos.y, 4, 0, Math.PI * 2);
          ctx.fill();
        });
      }

      ctx.globalAlpha = 1;
      ctx.strokeStyle = '#f00';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    document.getElementById('scale-x').oninput = (e) => {
      scaleX = parseFloat(e.target.value);
      document.getElementById('scale-x-val').textContent = scaleX.toFixed(2);
      draw();
    };

    document.getElementById('scale-y').oninput = (e) => {
      scaleY = parseFloat(e.target.value);
      document.getElementById('scale-y-val').textContent = scaleY.toFixed(2);
      draw();
    };

    document.getElementById('offset-x').oninput = (e) => {
      offsetX = parseInt(e.target.value);
      document.getElementById('offset-x-val').textContent = offsetX;
      draw();
    };

    document.getElementById('offset-y').oninput = (e) => {
      offsetY = parseInt(e.target.value);
      document.getElementById('offset-y-val').textContent = offsetY;
      draw();
    };

    document.getElementById('rotation').oninput = (e) => {
      rotation = parseInt(e.target.value);
      document.getElementById('rotation-val').textContent = rotation + '¬∞';
      draw();
    };

    document.getElementById('opacity').oninput = (e) => {
      opacity = parseFloat(e.target.value);
      document.getElementById('opacity-val').textContent = opacity.toFixed(1);
      draw();
    };

    document.getElementById('width').oninput = (e) => {
      lineWidth = parseInt(e.target.value);
      document.getElementById('width-val').textContent = lineWidth;
      draw();
    };

    document.getElementById('show-nodes').onchange = (e) => {
      showNodes = e.target.checked;
      draw();
    };

    document.getElementById('show-roundabouts').onchange = (e) => {
      showRoundabouts = e.target.checked;
      draw();
    };

    document.getElementById('reset-scale').onclick = () => {
      scaleX = scaleY = 1.0;
      document.getElementById('scale-x').value = 1.0;
      document.getElementById('scale-y').value = 1.0;
      document.getElementById('scale-x-val').textContent = '1.00';
      document.getElementById('scale-y-val').textContent = '1.00';
      draw();
    };

    document.getElementById('reset-offset').onclick = () => {
      offsetX = offsetY = 0;
      document.getElementById('offset-x').value = 0;
      document.getElementById('offset-y').value = 0;
      document.getElementById('offset-x-val').textContent = '0';
      document.getElementById('offset-y-val').textContent = '0';
      draw();
    };

    document.getElementById('reset-rotation').onclick = () => {
      rotation = 0;
      document.getElementById('rotation').value = 0;
      document.getElementById('rotation-val').textContent = '0¬∞';
      draw();
    };

    document.getElementById('reset-all').onclick = () => {
      if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?')) {
        document.getElementById('reset-scale').click();
        document.getElementById('reset-offset').click();
        document.getElementById('reset-rotation').click();
        opacity = 0.8;
        lineWidth = 8;
        document.getElementById('opacity').value = 0.8;
        document.getElementById('width').value = 8;
        document.getElementById('opacity-val').textContent = '0.8';
        document.getElementById('width-val').textContent = '8';
        draw();
      }
    };

    document.getElementById('export-coords').onclick = () => {
      if (roadNodes.length === 0) {
        alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–∞—Ä—Ç—É –¥–æ—Ä–æ–≥!');
        return;
      }
      
      const output = `// –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã\n// ScaleX: ${scaleX}, ScaleY: ${scaleY}\n// Offset: (${offsetX}, ${offsetY})\n// Rotation: ${rotation}¬∞\n\n`;
      
      const exportArea = document.getElementById('export-output');
      exportArea.textContent = output + JSON.stringify(roadNodes, null, 2);
      exportArea.style.display = 'block';
      
      navigator.clipboard.writeText(exportArea.textContent);
      alert('‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    };

    document.getElementById('export-code').onclick = () => {
      if (roadNodes.length === 0) {
        alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–∞—Ä—Ç—É –¥–æ—Ä–æ–≥!');
        return;
      }
      
      const code = `// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ –∏–≥—Ä–µ:
// –í road_system.js –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏:

const ROAD_TRANSFORM = {
  scaleX: ${scaleX.toFixed(2)},
  scaleY: ${scaleY.toFixed(2)},
  offsetX: ${offsetX},
  offsetY: ${offsetY},
  rotation: ${rotation}
};

// –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∫ –∫–∞–∂–¥–æ–º—É —É–∑–ª—É:
function transformNode(node) {
  let x = node.x * ROAD_TRANSFORM.scaleX;
  let y = node.y * ROAD_TRANSFORM.scaleY;
  
  // –ü–æ–≤–æ—Ä–æ—Ç
  const rad = ROAD_TRANSFORM.rotation * Math.PI / 180;
  const nx = x * Math.cos(rad) - y * Math.sin(rad);
  const ny = x * Math.sin(rad) + y * Math.cos(rad);
  
  return {
    x: nx + (ROAD_TRANSFORM.offsetX / 1000),
    y: ny + (ROAD_TRANSFORM.offsetY / 1000)
  };
}`;
      
      const exportArea = document.getElementById('export-output');
      exportArea.textContent = code;
      exportArea.style.display = 'block';
      
      navigator.clipboard.writeText(code);
      alert('‚úÖ –ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    draw();
  </script>
</body>
</html>